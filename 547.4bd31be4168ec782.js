"use strict";(self.webpackChunkThe_Circus=self.webpackChunkThe_Circus||[]).push([[547],{8547:(j,p,l)=>{l.r(p),l.d(p,{PollModule:()=>R});var a=l(6895),f=l(8954),u=l(9833),c=l(433),t=l(8256),m=l(6613),_=l(7139),g=l(4426),h=l(7083);function P(o,n){if(1&o&&(t.TgZ(0,"div",4)(1,"div",5)(2,"div",1)(3,"div",6)(4,"span",7),t._uU(5),t.qZA()(),t.TgZ(6,"div",8)(7,"h4",9),t._uU(8),t.qZA()(),t.TgZ(9,"div",6)(10,"div")(11,"p",10),t._uU(12,"Voti"),t.qZA(),t.TgZ(13,"p",11),t._uU(14),t.qZA()()()()()()),2&o){const e=n.$implicit,i=n.index;t.xp6(4),t.Q6J("ngClass",0===i?"badge-gold":1===i?"badge-silver":2===i?"badge-brown":""),t.xp6(1),t.hij("",i+1,"\xb0"),t.xp6(3),t.AsE(" ",e.firstName," ",e.lastName,""),t.xp6(6),t.Oqu(e.count)}}let x=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-poll-results-list"]],inputs:{results:"results"},decls:4,vars:1,consts:[[1,"container"],[1,"row"],[1,"col-md-6","offset-md-3"],["class","card mb-3",4,"ngFor","ngForOf"],[1,"card","mb-3"],[1,"card-body"],[1,"col-2","d-flex","text-center","align-items-center","justify-content-center"],[1,"badge","badge-circle","d-flex","align-items-center","justify-content-center",3,"ngClass"],[1,"col-8","d-flex","text-center","align-items-center","justify-content-center"],[1,"m-0","long-name"],[1,"vote-label"],[1,"m-0"]],template:function(e,i){1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2),t.YNc(3,P,15,5,"div",3),t.qZA()()()),2&e&&(t.xp6(3),t.Q6J("ngForOf",i.results))},dependencies:[a.mk,a.sg],styles:[".badge-circle[_ngcontent-%COMP%]{display:flex;width:30px;height:30px;border-radius:50%;text-align:center;line-height:30px;background-color:var(--primary-color)}.badge-gold[_ngcontent-%COMP%]{background-color:gold;color:#000}.badge-silver[_ngcontent-%COMP%]{background-color:silver;color:#000}.badge-brown[_ngcontent-%COMP%]{background-color:#cd7f32;color:#000}.vote-label[_ngcontent-%COMP%]{font-size:.8em;margin:0}.long-name[_ngcontent-%COMP%]{font-size:1em}"]}),o})();var v=l(6233);function C(o,n){1&o&&(t.TgZ(0,"p"),t._uU(1,"Prossima votazione:"),t.qZA())}function Z(o,n){if(1&o&&(t.TgZ(0,"p"),t._uU(1),t.ALo(2,"customDate"),t.qZA()),2&o){const e=t.oxw();t.xp6(1),t.Oqu(t.lcZ(2,1,e.nextPoll.start_datetime))}}let b=(()=>{class o{constructor(){}ngOnInit(){}}return o.\u0275fac=function(e){return new(e||o)},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-no-poll-active"]],inputs:{nextPoll:"nextPoll"},decls:9,vars:2,consts:[[1,"col-md-12","text-center"],[1,"emoji-big"],[4,"ngIf"]],template:function(e,i){1&e&&(t.TgZ(0,"div",0)(1,"p")(2,"span",1),t._uU(3,"\u{1f62d}"),t.qZA()(),t.TgZ(4,"p"),t._uU(5,"Non ci sono sondaggi attivi in questo momento"),t.qZA(),t._UZ(6,"br"),t.YNc(7,C,2,0,"p",2),t.YNc(8,Z,3,3,"p",2),t.qZA()),2&e&&(t.xp6(7),t.Q6J("ngIf",i.nextPoll),t.xp6(1),t.Q6J("ngIf",i.nextPoll))},dependencies:[a.O5,v.F]}),o})();function T(o,n){1&o&&(t.TgZ(0,"div",2)(1,"div",3),t._UZ(2,"app-loading-animation"),t.qZA()())}function A(o,n){if(1&o&&(t.TgZ(0,"div",2)(1,"div",3),t._UZ(2,"app-no-poll-active",4),t.qZA()()),2&o){const e=t.oxw();t.xp6(2),t.Q6J("nextPoll",e.nextPoll)}}function S(o,n){1&o&&(t.TgZ(0,"p"),t._uU(1,"Inserisci il nome di un Partecipante per votare"),t.qZA())}function N(o,n){if(1&o&&(t.TgZ(0,"p"),t._uU(1),t.ALo(2,"customDate"),t.qZA()),2&o){const e=t.oxw(3);t.xp6(1),t.hij("Prossima votazione ",t.lcZ(2,1,e.nextPoll.start_datetime),"")}}function I(o,n){if(1&o&&(t.TgZ(0,"div")(1,"p"),t._uU(2,"Sondaggio chiuso, non si accettano pi\xf9 voti"),t.qZA(),t.YNc(3,N,3,3,"p",7),t.qZA()),2&o){const e=t.oxw(2);t.xp6(3),t.Q6J("ngIf",e.nextPoll)}}function O(o,n){1&o&&(t.TgZ(0,"p"),t._uU(1," Vota di nuovo per modificare il voto, hai 5 minuti per modificare la tua scelta "),t.qZA())}function y(o,n){if(1&o&&(t.TgZ(0,"div",12)(1,"div",13)(2,"p"),t._uU(3,"Hai votato per:"),t.qZA(),t.TgZ(4,"h4"),t._uU(5),t.qZA(),t.YNc(6,O,2,0,"p",7),t.qZA()()),2&o){const e=t.oxw(2);t.xp6(5),t.AsE("",e.vote.vote.user.first_name," ",e.vote.vote.user.last_name,""),t.xp6(1),t.Q6J("ngIf",!e.vote||e.vote&&e.vote.is_vote_editable)}}function J(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"li")(1,"a",23),t.NdJ("click",function(){const r=t.CHM(e).$implicit,d=t.oxw(4);return t.KtG(d.selectParticipant(r))}),t._uU(2),t.qZA()()}if(2&o){const e=n.$implicit;t.xp6(2),t.AsE(" ",e.user.first_name," ",e.user.last_name," ")}}function M(o,n){if(1&o&&(t.TgZ(0,"div",20)(1,"ul",21),t.YNc(2,J,3,2,"li",22),t.qZA()()),2&o){const e=t.oxw(3);t.xp6(2),t.Q6J("ngForOf",e.filteredParticipants)}}function q(o,n){1&o&&(t.TgZ(0,"div",24),t._uU(1," Voto non valido "),t.qZA())}function U(o,n){1&o&&(t.TgZ(0,"div",24),t._uU(1," Il tuo tempo per votare \xe8 terminato, ricarica la pagina "),t.qZA())}function w(o,n){1&o&&(t.TgZ(0,"div",24),t._uU(1," Contatto non trovato "),t.qZA())}function Q(o,n){1&o&&(t.TgZ(0,"div",24),t._uU(1," Non puoi votare per te stesso, daiii "),t.qZA())}function F(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"form",14),t.NdJ("ngSubmit",function(){t.CHM(e);const s=t.oxw(2);return t.KtG(s.sendVote())}),t.TgZ(1,"div",15)(2,"input",16),t.NdJ("selectItem",function(s){t.CHM(e);const r=t.oxw(2);return t.KtG(r.selectParticipant(s))}),t.qZA()(),t.TgZ(3,"div"),t.YNc(4,M,3,1,"div",17),t.qZA(),t._UZ(5,"br"),t.YNc(6,q,2,0,"div",18),t.YNc(7,U,2,0,"div",18),t.YNc(8,w,2,0,"div",18),t.YNc(9,Q,2,0,"div",18),t.TgZ(10,"button",19),t._uU(11,"Invia"),t.qZA()()}if(2&o){const e=t.oxw(2);t.Q6J("formGroup",e.form),t.xp6(4),t.Q6J("ngIf",e.filteredParticipants.length>0),t.xp6(2),t.Q6J("ngIf",e.form.controls.vote.invalid&&e.form.controls.vote.touched),t.xp6(1),t.Q6J("ngIf",e.error==e.errorService.editTimeExpired),t.xp6(1),t.Q6J("ngIf",e.error==e.errorService.participantNotFound),t.xp6(1),t.Q6J("ngIf",e.error==e.errorService.selfVote),t.xp6(1),t.Q6J("disabled",e.form.invalid)}}function Y(o,n){if(1&o&&(t.TgZ(0,"div",2)(1,"div",3)(2,"div",5)(3,"h2",6),t._uU(4),t.qZA(),t.YNc(5,S,2,0,"p",7),t.YNc(6,I,4,1,"div",7),t.YNc(7,y,7,3,"div",8),t.YNc(8,F,12,7,"form",9),t.qZA()(),t._UZ(9,"br"),t.TgZ(10,"div",3)(11,"div",10),t._UZ(12,"app-poll-chart",11),t.qZA()(),t.TgZ(13,"div",3)(14,"div",10),t._UZ(15,"app-poll-results-list",11),t.qZA()()()),2&o){const e=t.oxw();t.xp6(4),t.Oqu(e.currentPoll.question),t.xp6(1),t.Q6J("ngIf",e.currentPoll.is_active&&!e.vote),t.xp6(1),t.Q6J("ngIf",!e.currentPoll.is_active),t.xp6(1),t.Q6J("ngIf",e.vote&&e.vote.vote.user),t.xp6(1),t.Q6J("ngIf",e.currentPoll.is_active&&!e.vote||e.vote&&e.vote.is_vote_editable),t.xp6(4),t.Q6J("results",e.currentPollResults),t.xp6(3),t.Q6J("results",e.currentPollResults)}}class V{constructor(){this.noError="no_error",this.participantNotFound="participant_not_found",this.editTimeExpired="edit_time_expired",this.selfVote="self_vote",this.pollClosed="poll_closed",this.alreadyVoted="already_voted",this.genericError="generic_error"}}const E=[{path:"",component:(()=>{class o{constructor(e,i,s){this.fb=e,this.pollService=i,this.eventService=s,this.filteredParticipants=[],this.currentPollResults=[],this.loading=!0,this.errorService=new V,this.form=this.fb.group({id:[null,c.kI.required],vote:["",c.kI.required]})}ngOnInit(){this.getData(),this.currentPollSubscription=setInterval(()=>{this.getData()},5e3),this.eventService.getParticipants().subscribe({next:e=>{this.participants=e}}),this.form.controls.vote.valueChanges.subscribe(e=>{const i=e.toLowerCase();this.filteredParticipants=i.length>=3?this.filterParticipants(i):[],console.log(this.filteredParticipants)})}ngOnDestroy(){this.currentPollSubscription&&clearInterval(this.currentPollSubscription)}getData(){this.pollService.getPoll().subscribe(e=>{e.length||(this.loading=!1),this.polls=e,this.nextPoll=null;let i=!1;const s=this.currentPoll;for(const r of e){if(this.pollService.isActive(r.start_datetime,r.end_datetime)){this.currentPoll=r,i=!0,(!s&&s!==r||s&&s.id!==r.id)&&(this.vote=null,this.pollService.getPollVote().subscribe({next:d=>{this.votes=d.filter(D=>!!this.currentPoll&&D.poll===this.currentPoll.id),this.votes.length&&(this.vote=this.votes[0]),this.loading=!1}}));break}this.pollService.isClosed(r.end_datetime)&&!i&&(this.currentPoll=r),!this.nextPoll&&this.pollService.isFuture(r.start_datetime)&&(this.nextPoll=r,this.loading=!1)}this.currentPoll&&(this.currentPollResults=this.pollService.generateResults(this.currentPoll.votes))})}filterParticipants(e){return this.participants.filter(i=>`${i.user.first_name} ${i.user.last_name}`.toLowerCase().includes(e))}selectParticipant(e){this.form.patchValue({id:e.id,vote:`${e.user.first_name} ${e.user.last_name}`}),this.filteredParticipants=[]}sendVote(){if(this.form.valid){this.error=this.errorService.noError;const e={next:i=>{console.log(i),this.vote=i,this.getData()},error:i=>{if(this.error=this.errorService.genericError,i.error.vote)switch(i.error.vote.code){case this.errorService.participantNotFound:this.error=this.errorService.participantNotFound;break;case this.errorService.selfVote:this.error=this.errorService.selfVote}if(i.error.poll&&i.error.poll.code===this.errorService.pollClosed&&(this.error=this.errorService.pollClosed),i.error.code)switch(i.error.code){case this.errorService.editTimeExpired:this.error=this.errorService.editTimeExpired;break;case this.errorService.alreadyVoted:this.error=this.errorService.alreadyVoted}}};this.vote?(this.vote.vote=this.form.value.id,this.pollService.putPollVote(this.vote.id,this.vote).subscribe(e)):this.currentPoll&&this.pollService.postPollVote({poll:this.currentPoll.id,vote:this.form.value.id}).subscribe(e)}}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(c.qu),t.Y36(m.X),t.Y36(_.y))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-poll"]],decls:4,vars:3,consts:[[1,"section","d-flex","align-items-center","min-vh-100"],["class","container",4,"ngIf"],[1,"container"],[1,"row","justify-content-center"],[3,"nextPoll"],[1,"col-md-6","text-center"],[1,"mb-3","title"],[4,"ngIf"],["class","card mb-3 vote-result",4,"ngIf"],["class","mt-3 text-center",3,"formGroup","ngSubmit",4,"ngIf"],[1,"col"],[3,"results"],[1,"card","mb-3","vote-result"],[1,"card-body"],[1,"mt-3","text-center",3,"formGroup","ngSubmit"],[1,"input-group"],["type","text","formControlName","vote","placeholder","Scrivi un nome",1,"form-control",3,"selectItem"],["class","dropdown",4,"ngIf"],["class","alert alert-danger",4,"ngIf"],["type","submit",1,"mt-3","btn","btn-secondary",3,"disabled"],[1,"dropdown"],["aria-labelledby","searchDropdown",1,"search-suggestions"],[4,"ngFor","ngForOf"],[3,"click"],[1,"alert","alert-danger"]],template:function(e,i){1&e&&(t.TgZ(0,"div",0),t.YNc(1,T,3,0,"div",1),t.YNc(2,A,3,1,"div",1),t.YNc(3,Y,16,7,"div",1),t.qZA()),2&e&&(t.xp6(1),t.Q6J("ngIf",i.loading||null==i.polls),t.xp6(1),t.Q6J("ngIf",!i.loading&&!i.currentPoll&&(i.polls&&i.nextPoll||!i.loading)),t.xp6(1),t.Q6J("ngIf",!i.loading&&i.currentPoll))},dependencies:[a.sg,a.O5,c._Y,c.Fj,c.JJ,c.JL,c.sg,c.u,g.C,h.r,x,b,v.F],styles:[".input-group-text[_ngcontent-%COMP%]{border-radius:10px 0 0 10px;background-color:var(--secondary-color)}.vote-result[_ngcontent-%COMP%]{background-color:#8fd3a7}.dropdown[_ngcontent-%COMP%]   .dropdown-menu[_ngcontent-%COMP%]{position:absolute;top:100%;left:0;width:100%}.search-suggestions[_ngcontent-%COMP%]{border-radius:var(--border-radius)}ul.search-suggestions[_ngcontent-%COMP%]{position:absolute;list-style-type:none;background-color:#fff;border:1px solid #ccc;padding:0;margin:0;z-index:999}ul.search-suggestions[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{padding:5px}ul.search-suggestions[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:hover{background-color:#f5f5f5}ul.search-suggestions[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{text-decoration:none;color:#333}ul.search-suggestions[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{text-decoration:underline}"]}),o})()}];let k=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({imports:[u.Bz.forChild(E),u.Bz]}),o})(),R=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({imports:[a.ez,c.u5,c.UX,f.O,k]}),o})()}}]);