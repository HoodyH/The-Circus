"use strict";(self.webpackChunkThe_Circus=self.webpackChunkThe_Circus||[]).push([[547],{8547:(j,d,r)=>{r.r(d),r.d(d,{PollModule:()=>E});var a=r(6895),v=r(8954),u=r(9833),c=r(433),g=r(7139),e=r(8256),m=r(6613),f=r(4426),_=r(7083),h=r(8385);function P(o,i){if(1&o&&(e.TgZ(0,"div",4)(1,"div",5)(2,"div",1)(3,"div",6)(4,"span",7),e._uU(5),e.qZA()(),e.TgZ(6,"div",8)(7,"h4",9),e._uU(8),e.qZA()(),e.TgZ(9,"div",6)(10,"div")(11,"p",10),e._uU(12,"Voti"),e.qZA(),e.TgZ(13,"p",11),e._uU(14),e.qZA()()()()()()),2&o){const t=i.$implicit,n=i.index;e.xp6(4),e.Q6J("ngClass",0===n?"badge-gold":1===n?"badge-silver":2===n?"badge-brown":""),e.xp6(1),e.hij("",n+1,"\xb0"),e.xp6(3),e.AsE(" ",t.firstName," ",t.lastName,""),e.xp6(6),e.Oqu(t.count)}}let x=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-poll-results-list"]],inputs:{results:"results"},decls:4,vars:1,consts:[[1,"container"],[1,"row"],[1,"col-md-6","offset-md-3"],["class","card mb-3",4,"ngFor","ngForOf"],[1,"card","mb-3"],[1,"card-body"],[1,"col-2","d-flex","text-center","align-items-center","justify-content-center"],[1,"badge","badge-circle","d-flex","align-items-center","justify-content-center",3,"ngClass"],[1,"col-8","d-flex","text-center","align-items-center","justify-content-center"],[1,"m-0","long-name"],[1,"vote-label"],[1,"m-0"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2),e.YNc(3,P,15,5,"div",3),e.qZA()()()),2&t&&(e.xp6(3),e.Q6J("ngForOf",n.results))},dependencies:[a.mk,a.sg],styles:[".badge-circle[_ngcontent-%COMP%]{display:flex;width:30px;height:30px;border-radius:50%;text-align:center;line-height:30px;background-color:var(--primary-color)}.badge-gold[_ngcontent-%COMP%]{background-color:gold;color:#000}.badge-silver[_ngcontent-%COMP%]{background-color:silver;color:#000}.badge-brown[_ngcontent-%COMP%]{background-color:#cd7f32;color:#000}.vote-label[_ngcontent-%COMP%]{font-size:.8em;margin:0}.long-name[_ngcontent-%COMP%]{font-size:1em}"]}),o})();var p=r(6233);function C(o,i){1&o&&(e.TgZ(0,"p"),e._uU(1,"Prossima votazione:"),e.qZA())}function Z(o,i){if(1&o&&(e.TgZ(0,"p"),e._uU(1),e.ALo(2,"customDate"),e.qZA()),2&o){const t=e.oxw();e.xp6(1),e.Oqu(e.lcZ(2,1,t.nextPoll.start_datetime))}}let b=(()=>{class o{constructor(){}ngOnInit(){}}return o.\u0275fac=function(t){return new(t||o)},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-no-poll-active"]],inputs:{nextPoll:"nextPoll"},decls:9,vars:2,consts:[[1,"col-md-12","text-center"],[1,"emoji-big"],[4,"ngIf"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0)(1,"p")(2,"span",1),e._uU(3,"\u{1f62d}"),e.qZA()(),e.TgZ(4,"p"),e._uU(5,"Non ci sono sondaggi attivi in questo momento"),e.qZA(),e._UZ(6,"br"),e.YNc(7,C,2,0,"p",2),e.YNc(8,Z,3,3,"p",2),e.qZA()),2&t&&(e.xp6(7),e.Q6J("ngIf",n.nextPoll),e.xp6(1),e.Q6J("ngIf",n.nextPoll))},dependencies:[a.O5,p.F]}),o})();function T(o,i){1&o&&(e.TgZ(0,"div",2)(1,"div",3),e._UZ(2,"app-loading-animation"),e.qZA()())}function A(o,i){if(1&o&&(e.TgZ(0,"div",2)(1,"div",3),e._UZ(2,"app-no-poll-active",4),e.qZA()()),2&o){const t=e.oxw();e.xp6(2),e.Q6J("nextPoll",t.nextPoll)}}function S(o,i){1&o&&(e.TgZ(0,"p"),e._uU(1,"Scrivi il nome di un Partecipante per votare"),e.qZA())}function O(o,i){if(1&o&&(e.TgZ(0,"p"),e._uU(1),e.ALo(2,"customDate"),e.qZA()),2&o){const t=e.oxw(3);e.xp6(1),e.hij("Prossima votazione ",e.lcZ(2,1,t.nextPoll.start_datetime),"")}}function N(o,i){if(1&o&&(e.TgZ(0,"div")(1,"p"),e._uU(2,"Sondaggio chiuso, non si accettano pi\xf9 voti"),e.qZA(),e.YNc(3,O,3,3,"p",7),e.qZA()),2&o){const t=e.oxw(2);e.xp6(3),e.Q6J("ngIf",t.nextPoll)}}function M(o,i){1&o&&(e.TgZ(0,"p"),e._uU(1," Vota di nuovo per modificare il voto, hai 5 minuti per modificare la tua scelta "),e.qZA())}function y(o,i){if(1&o&&(e.TgZ(0,"div",13)(1,"div",14)(2,"p"),e._uU(3,"Hai votato per:"),e.qZA(),e.TgZ(4,"h4"),e._uU(5),e.qZA(),e.YNc(6,M,2,0,"p",7),e.qZA()()),2&o){const t=e.oxw(2);e.xp6(5),e.AsE("",t.vote.vote.user.first_name," ",t.vote.vote.user.last_name,""),e.xp6(1),e.Q6J("ngIf",!t.vote||t.vote&&t.vote.is_vote_editable)}}function I(o,i){1&o&&(e.TgZ(0,"div",18),e._uU(1," Voto non valido "),e.qZA())}function J(o,i){1&o&&(e.TgZ(0,"div",18),e._uU(1," Il tuo tempo per votare \xe8 terminato, ricarica la pagina "),e.qZA())}function q(o,i){1&o&&(e.TgZ(0,"div",18),e._uU(1," Contatto non trovato "),e.qZA())}function U(o,i){1&o&&(e.TgZ(0,"div",18),e._uU(1," Non puoi votare per te stesso, daiii "),e.qZA())}function Q(o,i){if(1&o){const t=e.EpF();e.TgZ(0,"form",15),e.NdJ("ngSubmit",function(){e.CHM(t);const l=e.oxw(2);return e.KtG(l.sendVote(null))}),e.TgZ(1,"app-dropdown",16),e.NdJ("valueSelected",function(l){e.CHM(t);const s=e.oxw(2);return e.KtG(s.sendVote(l))}),e.qZA(),e._UZ(2,"br"),e.YNc(3,I,2,0,"div",17),e.YNc(4,J,2,0,"div",17),e.YNc(5,q,2,0,"div",17),e.YNc(6,U,2,0,"div",17),e.qZA()}if(2&o){const t=e.oxw(2);e.Q6J("formGroup",t.form),e.xp6(1),e.Q6J("options",t.options)("valueId",t.form.value.vote),e.xp6(2),e.Q6J("ngIf",t.form.controls.vote.invalid&&t.form.controls.vote.touched),e.xp6(1),e.Q6J("ngIf",t.error==t.errorService.editTimeExpired),e.xp6(1),e.Q6J("ngIf",t.error==t.errorService.participantNotFound),e.xp6(1),e.Q6J("ngIf",t.error==t.errorService.selfVote)}}function V(o,i){if(1&o&&(e.TgZ(0,"div",2)(1,"div",3)(2,"div",5)(3,"h2",6),e._uU(4),e.qZA(),e.YNc(5,S,2,0,"p",7),e.YNc(6,N,4,1,"div",7),e.YNc(7,y,7,3,"div",8),e.YNc(8,Q,7,7,"form",9),e.qZA()(),e.TgZ(9,"div",3)(10,"div",10),e._UZ(11,"app-poll-chart",11),e.qZA()(),e.TgZ(12,"div",3)(13,"div",10),e._UZ(14,"app-poll-results-list",12),e.qZA()()()),2&o){const t=e.oxw();e.xp6(4),e.Oqu(t.currentPoll.question),e.xp6(1),e.Q6J("ngIf",t.currentPoll.is_active&&!t.vote),e.xp6(1),e.Q6J("ngIf",!t.currentPoll.is_active),e.xp6(1),e.Q6J("ngIf",t.vote&&t.vote.vote.user),e.xp6(1),e.Q6J("ngIf",t.currentPoll.is_active&&!t.vote||t.vote&&t.vote.is_vote_editable),e.xp6(3),e.Q6J("poll",t.currentPoll)("results",t.currentPollResults),e.xp6(3),e.Q6J("results",t.currentPollResults)}}class w{constructor(){this.noError="no_error",this.participantNotFound="participant_not_found",this.editTimeExpired="edit_time_expired",this.selfVote="self_vote",this.pollClosed="poll_closed",this.alreadyVoted="already_voted",this.genericError="generic_error"}}const Y=[{path:"",component:(()=>{class o{constructor(t,n,l){this.fb=t,this.pollService=n,this.eventService=l,this.options=[],this.currentPollResults=[],this.loading=!0,this.errorService=new w,this.form=this.fb.group({vote:[null,c.kI.required]})}ngOnInit(){this.getData(),this.currentPollSubscription=setInterval(()=>{this.getData()},5e3),this.eventService.getParticipants().subscribe({next:t=>{this.options=t.map(n=>({id:n.id,value:`${n.user.first_name} ${n.user.last_name}`}))}})}ngOnDestroy(){this.currentPollSubscription&&clearInterval(this.currentPollSubscription)}getData(){this.pollService.getPoll().subscribe(t=>{t.length||(this.loading=!1),this.polls=t,this.nextPoll=null;let n=!1;const l=this.currentPoll;for(const s of t){if(this.pollService.isActive(s.start_datetime,s.end_datetime)){this.currentPoll=s,n=!0,(!l&&l!==s||l&&l.id!==s.id)&&(this.vote=null,this.pollService.getPollVote().subscribe({next:R=>{this.votes=R.filter(D=>!!this.currentPoll&&D.poll===this.currentPoll.id),this.votes.length&&(this.vote=this.votes[0],this.form.setValue({vote:this.vote.vote.id}))}}));break}this.pollService.isClosed(s.end_datetime)&&!n&&(this.currentPoll=s,n=!0),!this.nextPoll&&this.pollService.isFuture(s.start_datetime)&&(this.nextPoll=s,this.loading=!1)}n||(this.currentPoll=null),this.currentPoll&&(this.currentPollResults=this.pollService.generateResults(this.currentPoll.votes),this.loading=!1)})}deleteVote(t){t&&this.pollService.deletePollVote(t.id).subscribe({next:()=>{this.form.reset({vote:null}),this.vote=null}})}sendVote(t){if(t&&(this.form.setValue({vote:t.id}),this.form.valid)){this.error=this.errorService.noError;const n={next:l=>{console.log(l),this.vote=l,this.getData()},error:l=>{if(this.error=this.errorService.genericError,l.error.vote)switch(l.error.vote.code){case this.errorService.participantNotFound:this.error=this.errorService.participantNotFound;break;case this.errorService.selfVote:this.error=this.errorService.selfVote}if(l.error.poll&&l.error.poll.code===this.errorService.pollClosed&&(this.error=this.errorService.pollClosed),l.error.code)switch(l.error.code){case this.errorService.editTimeExpired:this.error=this.errorService.editTimeExpired;break;case this.errorService.alreadyVoted:this.error=this.errorService.alreadyVoted}}};this.vote?(this.vote.vote=this.form.value.vote,this.pollService.putPollVote(this.vote.id,this.vote).subscribe(n)):this.currentPoll&&this.pollService.postPollVote({poll:this.currentPoll.id,vote:this.form.value.vote}).subscribe(n)}}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(c.qu),e.Y36(m.X),e.Y36(g.y3))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-poll"]],decls:4,vars:3,consts:[[1,"section","d-flex","align-items-center","min-vh-100"],["class","container",4,"ngIf"],[1,"container"],[1,"row","justify-content-center"],[3,"nextPoll"],[1,"col-md-6","text-center"],[1,"mb-3","title"],[4,"ngIf"],["class","card mb-3 vote-result",4,"ngIf"],["class","mt-3 text-center",3,"formGroup","ngSubmit",4,"ngIf"],[1,"col"],[3,"poll","results"],[3,"results"],[1,"card","mb-3","vote-result"],[1,"card-body"],[1,"mt-3","text-center",3,"formGroup","ngSubmit"],[3,"options","valueId","valueSelected"],["class","alert alert-danger",4,"ngIf"],[1,"alert","alert-danger"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0),e.YNc(1,T,3,0,"div",1),e.YNc(2,A,3,1,"div",1),e.YNc(3,V,15,8,"div",1),e.qZA()),2&t&&(e.xp6(1),e.Q6J("ngIf",n.loading||null==n.polls),e.xp6(1),e.Q6J("ngIf",!n.loading&&!n.currentPoll&&(n.polls&&n.nextPoll||!n.loading)),e.xp6(1),e.Q6J("ngIf",!n.loading&&n.currentPoll))},dependencies:[a.O5,c._Y,c.JL,c.sg,f.C,_.r,h.J,x,b,p.F],styles:[".input-group-text[_ngcontent-%COMP%]{border-radius:10px 0 0 10px;background-color:var(--secondary-color)}.vote-result[_ngcontent-%COMP%]{background-color:#8fd3a7}.dropdown[_ngcontent-%COMP%]   .dropdown-menu[_ngcontent-%COMP%]{position:absolute;top:100%;left:0;width:100%}.search-suggestions[_ngcontent-%COMP%]{border-radius:var(--border-radius)}ul.search-suggestions[_ngcontent-%COMP%]{position:absolute;list-style-type:none;background-color:#fff;border:1px solid #ccc;padding:0;margin:0;z-index:999}ul.search-suggestions[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{padding:5px}ul.search-suggestions[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:hover{background-color:#f5f5f5}ul.search-suggestions[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{text-decoration:none;color:#333}ul.search-suggestions[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{text-decoration:underline}"]}),o})()}];let F=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[u.Bz.forChild(Y),u.Bz]}),o})(),E=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[a.ez,c.u5,c.UX,v.O,F]}),o})()}}]);