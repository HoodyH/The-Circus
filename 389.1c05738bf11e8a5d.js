"use strict";(self.webpackChunkThe_Circus=self.webpackChunkThe_Circus||[]).push([[389],{5389:(J,a,s)=>{s.r(a),s.d(a,{LiveModule:()=>M});var c=s(6895),d=s(8954),u=s(9833),e=s(8256),p=s(7139),v=s(4624),m=s(6613),h=s(4426),f=s(7093);function g(i,o){if(1&i&&(e.ynx(0),e._UZ(1,"img",5),e.BQk()),2&i){const t=e.oxw(2);e.xp6(1),e.Q6J("src",t.currentFile.url,e.LSH)("alt",t.currentFile.id)}}function x(i,o){if(1&i){const t=e.EpF();e.ynx(0),e.TgZ(1,"video",6,7),e.NdJ("playing",function(l){e.CHM(t);const r=e.oxw(2);return e.KtG(r.calculateVideoTime(l))}),e._UZ(3,"source",8),e._uU(4," Il tuo browser non supporta la visualizzazione dei video. "),e.qZA(),e.BQk()}if(2&i){const t=e.oxw(2);e.xp6(1),e.Q6J("muted",!0),e.xp6(2),e.Q6J("src",t.currentFile.url,e.LSH)}}function C(i,o){if(1&i&&(e.TgZ(0,"p",9),e._uU(1,"Caricato da: "),e.TgZ(2,"strong"),e._uU(3),e.qZA()()),2&i){const t=e.oxw(2);e.xp6(3),e.AsE("",t.currentFile.user.first_name," ",t.currentFile.user.last_name,"")}}function T(i,o){if(1&i&&(e.TgZ(0,"div",1)(1,"div",2)(2,"div",2),e.YNc(3,g,2,2,"ng-container",3),e.YNc(4,x,5,2,"ng-container",3),e.YNc(5,C,4,2,"p",4),e.qZA()()()),2&i){const t=e.oxw();e.xp6(3),e.Q6J("ngIf","video/mp4"!==t.currentFile.type),e.xp6(1),e.Q6J("ngIf","video/mp4"===t.currentFile.type),e.xp6(1),e.Q6J("ngIf",t.currentFile)}}let S=(()=>{class i{constructor(){this.slidingTimeSeconds=10,this.slidingVideoMaxTimeSeconds=30,this.files=[],this.lastScrolledPhoto=new e.vpe}ngOnInit(){this.displayFile()}ngOnChanges(t){t.files&&t.files.currentValue&&t.files.currentValue.length&&!t.files.firstChange&&this.displayFile()}displayFile(){this.files&&this.files.length>0?(this.currentFile=this.files.pop(),this.setNextInteraction("video/mp4"!==this.currentFile.type?this.slidingTimeSeconds:this.slidingVideoMaxTimeSeconds)):(this.lastScrolledPhoto.emit(this.currentFile),this.setNextInteraction(this.slidingTimeSeconds))}calculateVideoTime(t){let n=Math.floor(t.target.duration);n>this.slidingTimeSeconds&&(n=this.slidingTimeSeconds),this.setNextInteraction(n)}setNextInteraction(t){this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout(()=>{this.displayFile()},1e3*t)}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-carousel"]],inputs:{slidingTimeSeconds:"slidingTimeSeconds",slidingVideoMaxTimeSeconds:"slidingVideoMaxTimeSeconds",files:"files"},outputs:{lastScrolledPhoto:"lastScrolledPhoto"},features:[e.TTD],decls:1,vars:1,consts:[["class","p-3",4,"ngIf"],[1,"p-3"],[1,""],[4,"ngIf"],["class","file-tag",4,"ngIf"],[1,"img-fluid",3,"src","alt"],["autoplay","","loop","",1,"video-fluid",3,"muted","playing"],["videoPlayer",""],["type","video/mp4",3,"src"],[1,"file-tag"]],template:function(t,n){1&t&&e.YNc(0,T,6,3,"div",0),2&t&&e.Q6J("ngIf",n.currentFile)},dependencies:[c.O5],styles:[".carousel-item[_ngcontent-%COMP%]{height:auto;max-height:50%}img[_ngcontent-%COMP%], video[_ngcontent-%COMP%]{max-height:60vh}.file-tag[_ngcontent-%COMP%]{position:relative;bottom:25px;border-radius:var(--border-radius);background-color:var(--primary-color);padding:.6em;color:#eee;width:-moz-fit-content;width:fit-content;margin:auto}"]}),i})();function _(i,o){if(1&i){const t=e.EpF();e.TgZ(0,"div",3)(1,"app-carousel",4),e.NdJ("lastScrolledPhoto",function(l){e.CHM(t);const r=e.oxw();return e.KtG(r.getCaruselData(l))}),e.qZA()()}if(2&i){const t=e.oxw();e.xp6(1),e.Q6J("files",t.files)}}function y(i,o){if(1&i&&(e.TgZ(0,"div",3),e._UZ(1,"app-poll-chart",5),e.qZA()),2&i){const t=e.oxw();e.xp6(1),e.Q6J("results",t.currentPollResults)}}function L(i,o){if(1&i&&(e.TgZ(0,"div",3),e._UZ(1,"app-current-status",6),e.qZA()),2&i){const t=e.oxw();e.xp6(1),e.Q6J("activities",t.event.activities)("eventDate",t.event.start_datetime)}}class F{constructor(){this.empty="empty",this.poll="poll",this.carusel="carusel"}}const P=[{path:"",component:(()=>{class i{constructor(t,n,l){this.eventService=t,this.galleryService=n,this.pollService=l,this.currentPollResults=[],this.currentLiveService=new F,this.currentLiveDisplay=this.currentLiveService.carusel}ngOnInit(){this.eventService.getEvent().subscribe({next:t=>{this.event=t}}),this.galleryService.getGallery().subscribe({next:t=>{this.gallery=t,this.files=t.files.length>0?t.files.slice(0,1):[]}}),this.pollService.getPoll().subscribe({next:t=>{this.polls=t}})}checkAction(){}getPollData(){this.pollService.getPoll().subscribe({next:t=>{for(const n of t)this.pollService.isActive(n.start_datetime,n.end_datetime)&&(this.currentPoll=n);this.currentPoll&&(this.currentPollResults=this.pollService.generateResults(this.currentPoll.votes))}})}getCaruselData(t){this.galleryService.getFiles().subscribe({next:n=>{const l=n.results;if(l&&t){const r=l.findIndex(Z=>Z.id===t.id);if(r>0)return void(this.files=l.slice(0,r))}this.files=l}})}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(p.y),e.Y36(v.j),e.Y36(m.X))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-live"]],decls:5,vars:3,consts:[[1,"section-live","min-vh-100","d-flex","align-items-center"],[1,"container"],["class","row",4,"ngIf"],[1,"row"],[1,"col","text-center","mx-auto",3,"files","lastScrolledPhoto"],[3,"results"],[3,"activities","eventDate"]],template:function(t,n){1&t&&(e.TgZ(0,"section",0)(1,"div",1),e.YNc(2,_,2,1,"div",2),e.YNc(3,y,2,1,"div",2),e.YNc(4,L,2,2,"div",2),e.qZA()()),2&t&&(e.xp6(2),e.Q6J("ngIf",n.currentLiveDisplay==n.currentLiveService.carusel),e.xp6(1),e.Q6J("ngIf",n.currentLiveDisplay==n.currentLiveService.poll),e.xp6(1),e.Q6J("ngIf",n.event))},dependencies:[c.O5,h.C,f.J,S],styles:[".section-live[_ngcontent-%COMP%]{position:relative;background:#eee no-repeat 65% 50%;background-size:cover;max-height:100vh}"]}),i})()}];let I=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[u.Bz.forChild(P),u.Bz]}),i})(),M=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[c.ez,d.O,I]}),i})()}}]);