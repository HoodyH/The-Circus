"use strict";(self.webpackChunkThe_Circus=self.webpackChunkThe_Circus||[]).push([[547],{8547:(j,d,r)=>{r.r(d),r.d(d,{PollModule:()=>E});var a=r(6895),v=r(8954),p=r(9833),c=r(433),t=r(8256),g=r(6613),m=r(7139),f=r(4426),_=r(7083),h=r(8385);function P(o,i){if(1&o&&(t.TgZ(0,"div",4)(1,"div",5)(2,"div",1)(3,"div",6)(4,"span",7),t._uU(5),t.qZA()(),t.TgZ(6,"div",8)(7,"h4",9),t._uU(8),t.qZA()(),t.TgZ(9,"div",6)(10,"div")(11,"p",10),t._uU(12,"Voti"),t.qZA(),t.TgZ(13,"p",11),t._uU(14),t.qZA()()()()()()),2&o){const e=i.$implicit,n=i.index;t.xp6(4),t.Q6J("ngClass",0===n?"badge-gold":1===n?"badge-silver":2===n?"badge-brown":""),t.xp6(1),t.hij("",n+1,"\xb0"),t.xp6(3),t.AsE(" ",e.firstName," ",e.lastName,""),t.xp6(6),t.Oqu(e.count)}}let x=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-poll-results-list"]],inputs:{results:"results"},decls:4,vars:1,consts:[[1,"container"],[1,"row"],[1,"col-md-6","offset-md-3"],["class","card mb-3",4,"ngFor","ngForOf"],[1,"card","mb-3"],[1,"card-body"],[1,"col-2","d-flex","text-center","align-items-center","justify-content-center"],[1,"badge","badge-circle","d-flex","align-items-center","justify-content-center",3,"ngClass"],[1,"col-8","d-flex","text-center","align-items-center","justify-content-center"],[1,"m-0","long-name"],[1,"vote-label"],[1,"m-0"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2),t.YNc(3,P,15,5,"div",3),t.qZA()()()),2&e&&(t.xp6(3),t.Q6J("ngForOf",n.results))},dependencies:[a.mk,a.sg],styles:[".badge-circle[_ngcontent-%COMP%]{display:flex;width:30px;height:30px;border-radius:50%;text-align:center;line-height:30px;background-color:var(--primary-color)}.badge-gold[_ngcontent-%COMP%]{background-color:gold;color:#000}.badge-silver[_ngcontent-%COMP%]{background-color:silver;color:#000}.badge-brown[_ngcontent-%COMP%]{background-color:#cd7f32;color:#000}.vote-label[_ngcontent-%COMP%]{font-size:.8em;margin:0}.long-name[_ngcontent-%COMP%]{font-size:1em}"]}),o})();var u=r(6233);function C(o,i){1&o&&(t.TgZ(0,"p"),t._uU(1,"Prossima votazione:"),t.qZA())}function Z(o,i){if(1&o&&(t.TgZ(0,"p"),t._uU(1),t.ALo(2,"customDate"),t.qZA()),2&o){const e=t.oxw();t.xp6(1),t.Oqu(t.lcZ(2,1,e.nextPoll.start_datetime))}}let b=(()=>{class o{constructor(){}ngOnInit(){}}return o.\u0275fac=function(e){return new(e||o)},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-no-poll-active"]],inputs:{nextPoll:"nextPoll"},decls:9,vars:2,consts:[[1,"col-md-12","text-center"],[1,"emoji-big"],[4,"ngIf"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0)(1,"p")(2,"span",1),t._uU(3,"\u{1f62d}"),t.qZA()(),t.TgZ(4,"p"),t._uU(5,"Non ci sono sondaggi attivi in questo momento"),t.qZA(),t._UZ(6,"br"),t.YNc(7,C,2,0,"p",2),t.YNc(8,Z,3,3,"p",2),t.qZA()),2&e&&(t.xp6(7),t.Q6J("ngIf",n.nextPoll),t.xp6(1),t.Q6J("ngIf",n.nextPoll))},dependencies:[a.O5,u.F]}),o})();function T(o,i){1&o&&(t.TgZ(0,"div",2)(1,"div",3),t._UZ(2,"app-loading-animation"),t.qZA()())}function A(o,i){if(1&o&&(t.TgZ(0,"div",2)(1,"div",3),t._UZ(2,"app-no-poll-active",4),t.qZA()()),2&o){const e=t.oxw();t.xp6(2),t.Q6J("nextPoll",e.nextPoll)}}function S(o,i){1&o&&(t.TgZ(0,"p"),t._uU(1,"Scrivi il nome di un Partecipante per votare"),t.qZA())}function O(o,i){if(1&o&&(t.TgZ(0,"p"),t._uU(1),t.ALo(2,"customDate"),t.qZA()),2&o){const e=t.oxw(3);t.xp6(1),t.hij("Prossima votazione ",t.lcZ(2,1,e.nextPoll.start_datetime),"")}}function N(o,i){if(1&o&&(t.TgZ(0,"div")(1,"p"),t._uU(2,"Sondaggio chiuso, non si accettano pi\xf9 voti"),t.qZA(),t.YNc(3,O,3,3,"p",7),t.qZA()),2&o){const e=t.oxw(2);t.xp6(3),t.Q6J("ngIf",e.nextPoll)}}function y(o,i){1&o&&(t.TgZ(0,"p"),t._uU(1," Vota di nuovo per modificare il voto, hai 5 minuti per modificare la tua scelta "),t.qZA())}function M(o,i){if(1&o&&(t.TgZ(0,"div",12)(1,"div",13)(2,"p"),t._uU(3,"Hai votato per:"),t.qZA(),t.TgZ(4,"h4"),t._uU(5),t.qZA(),t.YNc(6,y,2,0,"p",7),t.qZA()()),2&o){const e=t.oxw(2);t.xp6(5),t.AsE("",e.vote.vote.user.first_name," ",e.vote.vote.user.last_name,""),t.xp6(1),t.Q6J("ngIf",!e.vote||e.vote&&e.vote.is_vote_editable)}}function J(o,i){1&o&&(t.TgZ(0,"div",18),t._uU(1," Voto non valido "),t.qZA())}function I(o,i){1&o&&(t.TgZ(0,"div",18),t._uU(1," Il tuo tempo per votare \xe8 terminato, ricarica la pagina "),t.qZA())}function U(o,i){1&o&&(t.TgZ(0,"div",18),t._uU(1," Contatto non trovato "),t.qZA())}function q(o,i){1&o&&(t.TgZ(0,"div",18),t._uU(1," Non puoi votare per te stesso, daiii "),t.qZA())}function Q(o,i){if(1&o){const e=t.EpF();t.TgZ(0,"form",14),t.NdJ("ngSubmit",function(){t.CHM(e);const l=t.oxw(2);return t.KtG(l.sendVote())}),t.TgZ(1,"app-dropdown",15),t.NdJ("valueSelected",function(l){t.CHM(e);const s=t.oxw(2);return t.KtG(s.form.setValue({vote:null==l?null:l.id}))}),t.qZA(),t._UZ(2,"br"),t.YNc(3,J,2,0,"div",16),t.YNc(4,I,2,0,"div",16),t.YNc(5,U,2,0,"div",16),t.YNc(6,q,2,0,"div",16),t.TgZ(7,"button",17),t._uU(8,"Invia"),t.qZA()()}if(2&o){const e=t.oxw(2);t.Q6J("formGroup",e.form),t.xp6(1),t.Q6J("options",e.options),t.xp6(2),t.Q6J("ngIf",e.form.controls.vote.invalid&&e.form.controls.vote.touched),t.xp6(1),t.Q6J("ngIf",e.error==e.errorService.editTimeExpired),t.xp6(1),t.Q6J("ngIf",e.error==e.errorService.participantNotFound),t.xp6(1),t.Q6J("ngIf",e.error==e.errorService.selfVote),t.xp6(1),t.Q6J("disabled",e.form.invalid)}}function w(o,i){if(1&o&&(t.TgZ(0,"div",2)(1,"div",3)(2,"div",5)(3,"h2",6),t._uU(4),t.qZA(),t.YNc(5,S,2,0,"p",7),t.YNc(6,N,4,1,"div",7),t.YNc(7,M,7,3,"div",8),t.YNc(8,Q,9,7,"form",9),t.qZA()(),t.TgZ(9,"div",3)(10,"div",10),t._UZ(11,"app-poll-chart",11),t.qZA()(),t.TgZ(12,"div",3)(13,"div",10),t._UZ(14,"app-poll-results-list",11),t.qZA()()()),2&o){const e=t.oxw();t.xp6(4),t.Oqu(e.currentPoll.question),t.xp6(1),t.Q6J("ngIf",e.currentPoll.is_active&&!e.vote),t.xp6(1),t.Q6J("ngIf",!e.currentPoll.is_active),t.xp6(1),t.Q6J("ngIf",e.vote&&e.vote.vote.user),t.xp6(1),t.Q6J("ngIf",e.currentPoll.is_active&&!e.vote||e.vote&&e.vote.is_vote_editable),t.xp6(3),t.Q6J("results",e.currentPollResults),t.xp6(3),t.Q6J("results",e.currentPollResults)}}class Y{constructor(){this.noError="no_error",this.participantNotFound="participant_not_found",this.editTimeExpired="edit_time_expired",this.selfVote="self_vote",this.pollClosed="poll_closed",this.alreadyVoted="already_voted",this.genericError="generic_error"}}const F=[{path:"",component:(()=>{class o{constructor(e,n,l){this.fb=e,this.pollService=n,this.eventService=l,this.options=[],this.currentPollResults=[],this.loading=!0,this.errorService=new Y,this.form=this.fb.group({vote:[null,c.kI.required]})}ngOnInit(){this.getData(),this.currentPollSubscription=setInterval(()=>{this.getData()},5e3),this.eventService.getParticipants().subscribe({next:e=>{this.options=e.map(n=>({id:n.id,value:`${n.user.first_name} ${n.user.last_name}`}))}})}ngOnDestroy(){this.currentPollSubscription&&clearInterval(this.currentPollSubscription)}getData(){this.pollService.getPoll().subscribe(e=>{e.length||(this.loading=!1),this.polls=e,this.nextPoll=null;let n=!1;const l=this.currentPoll;for(const s of e){if(this.pollService.isActive(s.start_datetime,s.end_datetime)){this.currentPoll=s,n=!0,(!l&&l!==s||l&&l.id!==s.id)&&(this.vote=null,this.pollService.getPollVote().subscribe({next:R=>{this.votes=R.filter(D=>!!this.currentPoll&&D.poll===this.currentPoll.id),this.votes.length&&(this.vote=this.votes[0]),this.loading=!1}}));break}this.pollService.isClosed(s.end_datetime)&&!n&&(this.currentPoll=s),!this.nextPoll&&this.pollService.isFuture(s.start_datetime)&&(this.nextPoll=s,this.loading=!1)}this.currentPoll&&(this.currentPollResults=this.pollService.generateResults(this.currentPoll.votes))})}sendVote(){if(this.form.valid){this.error=this.errorService.noError;const e={next:n=>{console.log(n),this.vote=n,this.getData()},error:n=>{if(this.error=this.errorService.genericError,n.error.vote)switch(n.error.vote.code){case this.errorService.participantNotFound:this.error=this.errorService.participantNotFound;break;case this.errorService.selfVote:this.error=this.errorService.selfVote}if(n.error.poll&&n.error.poll.code===this.errorService.pollClosed&&(this.error=this.errorService.pollClosed),n.error.code)switch(n.error.code){case this.errorService.editTimeExpired:this.error=this.errorService.editTimeExpired;break;case this.errorService.alreadyVoted:this.error=this.errorService.alreadyVoted}}};this.vote?(this.vote.vote=this.form.value.vote,this.pollService.putPollVote(this.vote.id,this.vote).subscribe(e)):this.currentPoll&&this.pollService.postPollVote({poll:this.currentPoll.id,vote:this.form.value.vote}).subscribe(e)}}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(c.qu),t.Y36(g.X),t.Y36(m.y))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-poll"]],decls:4,vars:3,consts:[[1,"section","d-flex","align-items-center","min-vh-100"],["class","container",4,"ngIf"],[1,"container"],[1,"row","justify-content-center"],[3,"nextPoll"],[1,"col-md-6","text-center"],[1,"mb-3","title"],[4,"ngIf"],["class","card mb-3 vote-result",4,"ngIf"],["class","mt-3 text-center",3,"formGroup","ngSubmit",4,"ngIf"],[1,"col"],[3,"results"],[1,"card","mb-3","vote-result"],[1,"card-body"],[1,"mt-3","text-center",3,"formGroup","ngSubmit"],[3,"options","valueSelected"],["class","alert alert-danger",4,"ngIf"],["type","submit",1,"mt-3","btn","btn-secondary",3,"disabled"],[1,"alert","alert-danger"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0),t.YNc(1,T,3,0,"div",1),t.YNc(2,A,3,1,"div",1),t.YNc(3,w,15,7,"div",1),t.qZA()),2&e&&(t.xp6(1),t.Q6J("ngIf",n.loading||null==n.polls),t.xp6(1),t.Q6J("ngIf",!n.loading&&!n.currentPoll&&(n.polls&&n.nextPoll||!n.loading)),t.xp6(1),t.Q6J("ngIf",!n.loading&&n.currentPoll))},dependencies:[a.O5,c._Y,c.JL,c.sg,f.C,_.r,h.J,x,b,u.F],styles:[".input-group-text[_ngcontent-%COMP%]{border-radius:10px 0 0 10px;background-color:var(--secondary-color)}.vote-result[_ngcontent-%COMP%]{background-color:#8fd3a7}.dropdown[_ngcontent-%COMP%]   .dropdown-menu[_ngcontent-%COMP%]{position:absolute;top:100%;left:0;width:100%}.search-suggestions[_ngcontent-%COMP%]{border-radius:var(--border-radius)}ul.search-suggestions[_ngcontent-%COMP%]{position:absolute;list-style-type:none;background-color:#fff;border:1px solid #ccc;padding:0;margin:0;z-index:999}ul.search-suggestions[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{padding:5px}ul.search-suggestions[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:hover{background-color:#f5f5f5}ul.search-suggestions[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{text-decoration:none;color:#333}ul.search-suggestions[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{text-decoration:underline}"]}),o})()}];let V=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({imports:[p.Bz.forChild(F),p.Bz]}),o})(),E=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({imports:[a.ez,c.u5,c.UX,v.O,V]}),o})()}}]);